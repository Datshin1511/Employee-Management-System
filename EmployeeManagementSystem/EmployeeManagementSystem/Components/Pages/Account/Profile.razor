@page "/profile"

@inject EmployeeManagementSystem.Data.EMSDbContext DB
@inject NavigationManager NavigationManager

@using Microsoft.AspNetCore.Authorization

@attribute [StreamRendering]
@attribute [Authorize(Roles = "Manager,Staff")]
@rendermode InteractiveServer

<PageTitle>Profile</PageTitle>

<p class="display-4">Profile</p>
<hr />

@if(LoggedUser == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <Authorized>
        <div class="row">
            <EditForm method="post" Model="User" OnValidSubmit="UpdateEmployeeDetails" FormName="EmployeeProfileForm" Enhance>
                <DataAnnotationsValidator />
                <div class="row">
                    <div class="col-md-4 my-3">
                        <div class="form-group mb-3">
                            <label for="FirstName" class="form-label">First name:</label>
                            <InputText id="FirstName" class="form-control" @bind-Value="User.FirstName" disabled="@isDisabled" />
                            <ValidationMessage For="@(() => User.FirstName)" class="text-danger" />
                        </div>

                        <div class="form-group mb-3">
                            <label for="LastName" class="form-label">Last name:</label>
                            <InputText id="LastName" class="form-control" @bind-Value="User.LastName" disabled="@isDisabled" />
                            <ValidationMessage For="@(() => User.FirstName)" class="text-danger" />
                        </div>

                        <div class="form-group mb-3">
                            <label for="Age" class="form-label">Age:</label>
                            <InputText id="Age" class="form-control" @attributes=@FormAttributes.numberAttribute @bind-Value="User.Age" disabled="@isDisabled" />
                            <ValidationMessage For="@(() => User.Age)" class="text-danger" />
                        </div>

                        <div class="form-group row mb-3">
                            <label for="PhoneNumber" class="form-label">Phone number:</label>

                            <InputSelect id="EmployeeType" class="col form-select" @bind-Value="User.PhoneCode" disabled="@isDisabled">
                                @foreach (var phCode in PhoneCodes)
                                {
                                    <option value="@phCode" class="dropdown-item">@phCode</option>
                                }
                            </InputSelect>
                            <InputText id="PhoneNumber" class="col form-control" @attributes=@FormAttributes.numberAttribute @bind-Value="User.PhoneNumber" disabled="@isDisabled" />

                            <ValidationMessage For="@(() => User.PhoneNumber)" class="text-danger" />
                        </div>

                        <div class="form-group mb-3">
                            <label for="EmployeeType" class="form-label">Designation:</label>
                            <InputText id="EmployeeType" class="col form-control" @bind-Value="User.EmployeeType" disabled />
                            <ValidationMessage For="@(() => User.EmployeeType)" class="text-danger" />
                        </div>
                    </div>

                    <div class="col-md-4 my-3">
                        <div class="form-group mb-3">
                            <label for="EmailID" class="form-label fw-bold">Email ID</label>
                            <InputText id="EmailID" class="form-control" @attributes=@FormAttributes.emailAttribute @bind-Value="User.EmailID" disabled="@isDisabled" />
                            <ValidationMessage For="@(() => User.EmailID)" class="text-danger" />
                        </div>

                        <div class="form-group mb-3">
                            <label for="EmailPassword" class="form-label fw-bold">Password</label>
                            <InputText id="EmailPassword" class="form-control" @attributes=@FormAttributes.passwordAttribute @bind-Value="User.EmailPassword" disabled="@isDisabled" />
                            <ValidationMessage For="@(() => User.EmailPassword)" class="text-danger" />
                        </div>

                        @if (!isDisabled)
                        {
                            <button type="submit" class="btn btn-outline-success px-5">@ButtonTitle</button>
                        }

                        @if (isEditMessageVisible)
                        {
                            <div>
                                <p class="text-success">@editStatusMessage</p>
                            </div>
                        }

                    </div>
                </div>

                <hr />
            </EditForm>

            <div class="col-md-4 my-3">
                <button type="reset" class="btn btn-outline-danger" @onclick="EditUserDetails">Edit Details</button>
            </div>

        </div>
    </Authorized>
    
}
